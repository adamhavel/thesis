\documentclass[thesis=M,english,hidelinks]{FITthesis}[2012/10/20]

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% TYPOGRAPHY
\usepackage{inconsolata}
\usepackage{tgpagella}
\usepackage{PTSans}

\linespread{1.3}

\setsecheadstyle{\bfseries\LARGE\sffamily}
\setsubsecheadstyle{\bfseries\large\sffamily}
% \setsubsubsecheadstyle{\normalsize\scshape\raggedright}

\newcommand{\code}{\texttt}

\usepackage{graphicx}
% \usepackage{subfig} %subfigures

\usepackage{dirtree}

% % list of acronyms
% %\usepackage[acronym,nonumberlist,toc,numberedsection=autolabel]{glossaries}

\department{Department of Software Engineering}
\title{Thesis title (SPECIFY)}
\authorGN{Adam}
\authorFN{Havel}
\author{Adam Havel}
\authorWithDegrees{Bc. Adam Havel}
\supervisor{doc. Ing. Tomáš Vitvar, Ph.D.}
\acknowledgements{THANKS}
\abstractEN{Summarize the contents and contribution of your work in a few sentences in English language.}
\abstractCS{V n{\v e}kolika v{\v e}t{\' a}ch shr{\v n}te obsah a p{\v r}{\' i}nos t{\' e}to pr{\' a}ce v {\v c}esk{\' e}m jazyce.}
\placeForDeclarationOfAuthenticity{Prague}
\keywordsCS{Replace with comma-separated list of keywords in Czech.}
\keywordsEN{Replace with comma-separated list of keywords in English.}
\declarationOfAuthenticityOption{1} %select as appropriate, according to the desired license (integer 1-6)


\begin{document}


\setsecnumdepth{part}
\chapter{Introduction}

Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure \cite{rybicka} reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?

Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure \cite{rybicka} reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?

\setsecnumdepth{all}

\chapter{Realisation}

\section{Authentication}

No part of the system is accessible without authentication. Upon loading, the client makes a \code{GET} request to a resource defined at \code{/api/user} and appends a session identifier if a cookie is found. The server then tries to look up the identifier in MongoDB-backed session store. If successful, it checks whether the session has not expired---if that is not the case, it sends the client a \textit{JSON} object containing information about the particular user. The information is obtained by deserializing the user identifier from the session and using it to fetch relevant data from the database. The client application then fills its \code{User} service with the received object and the user is allowed to continue as authenticated.

\subsection{Logging in}

In the opposite case---either no session was found or it has already expired---the server responds with a 401 status code which forces the client to redirect the user to a login form page. After filling in the form, the client makes a new request to the \code{api/user} resource, this time using the \code{POST} method, sending along user credentials. These credentials are then checked against a faculty \textit{LDAP} server running at \code{ldap.fit.cvut.cz} using a secure connection. If user's identity is verified, the \textit{LDAP} server responds with basic information about the user. Back at the application server, the database is queried with the user identifier for additional data. It either finds a relevant entry or not. In the former case, the entry is updated with a new timestamp, representing the last login time, and the server sends it to the client as a \textit{JSON} object, the same as before. If the latter is the case, it means that the user is logging in for the first time.

A new instance of \code{User} model is then created and filled with the available data. What remains unknown is the user's role---that is, if he or she is a student or a teacher. That information can be obtained by making a request to \textit{KOSapi}, a faculty service that provides a \textit{REST API} over the university information system \textit{KOS}. To find out the role of a person with a given user identifier we can utilize the resource \code{/people/\{uid\}}. With that issue resolved, we can continue by looking up all courses the user either studies or teaches by using the resources \code{/students/\{uid\}/enrolledCourses} and \code{/teachers/\{uid\}/courses}, respectively. After obtaining all the neccessary data, the new user is saved in the database and sent to the client.

\subsection{Client-side verification}

When the client receives the authentication data and stores it in the appropriate service, the user can start to use the application with the scope assigned to his role. Whenever he navigates to a different state an event listener checks whether the \code{User} service is properly set. If it is empty, the user is redirected to a login form page and any navigation elsewhere is disabled until he successfully logs in. The authentication is thus verified only via the client-side service which might not be up to date with the server. This is sufficient for some operations and serves to mitigate any latency that would arise from communication between the client and the server.

When the user logs out, the \code{User} service is unset and the client sends a \code{DELETE} request to the \code{/api/user} resource which prompts the server to discard the session. Nonetheless, the client session might also be terminated at the server end, either by force or because it expired. It is therefore neccessary that the client recognizes this situation and acts accordingly. This is ensured through a HTTP interception service that monitors every response the client receives from the server when it tries to reach a resource. In case the response contains a status code of 401, it means the session has been ended and the user is redirected to a login form page.

The response code 401 is also reserved for the situation when a user is not authorized to view a selected resource. This applies for example in the case when a user with the student role requests a different student's results. Nevertheless, such request is never made on behalf of the client application. It can only occur when the user tries to reach the server resource directly, via the provided API.


\setsecnumdepth{part}
\chapter{Conclusion}


\bibliographystyle{iso690}
\bibliography{mybibliographyfile}

\setsecnumdepth{all}
\appendix

\chapter{Acronyms}

\begin{description}
   \item[API] Application Programming Interface
   \item{HTTP} Hypertext Transfer Protocol
   \item[JSON] JavaScript Object notation
   \item[LDAP] Lightweight Directory Access Protocol
   \item{REST} Representational State Transfer
\end{description}


\chapter{Contents of enclosed CD}

\begin{figure}
   \dirtree{%
      .1 readme.txt\DTcomment{the file with CD contents description}.
      .1 exe\DTcomment{the directory with executables}.
      .1 src\DTcomment{the directory of source codes}.
      .2 wbdcm\DTcomment{implementation sources}.
      .2 thesis\DTcomment{the directory of \LaTeX{} source codes of the thesis}.
      .1 text\DTcomment{the thesis text directory}.
      .2 thesis.pdf\DTcomment{the thesis text in PDF format}.
      .2 thesis.ps\DTcomment{the thesis text in PS format}.
   }
\end{figure}

\end{document}
